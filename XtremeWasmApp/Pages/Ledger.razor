@page "/Ledger"
@inject WebApiService Api
@inject IJSRuntime Js
<AuthorizeView>
    <Authorized>

        <div align-center style="max-width:450px;margin: auto;text-align:center" class="mt-3 pt-0">
            <MudPaper Elevation="2" Class="py-3 px-4">
                <h3>Account Statement</h3>
                <MudGrid Spacing="0" Justify="Justify.Center">
                    <MudItem xs="12">
                        <MudNumericField Label="Party Code" HideSpinButtons="true" Disabled="@loading" Immediate="true" @bind-Value="@CodeInput">
                        </MudNumericField>
                    </MudItem>
                    <MudItem xs="12">
                        <MudDateRangePicker PickerVariant="PickerVariant.Dialog" HelperText="From date ➜ To date" Disabled="@loading" Culture="System.Globalization.CultureInfo.InvariantCulture" DateFormat="dd-MMM-yyyy" TitleDateFormat="dd-MMM-yyyy" MaxDate="@DateTime.Now" @bind-DateRange="_dateRange" Editable="true">

                        </MudDateRangePicker>
                    </MudItem>
                    <MudItem xs="12">
                        <MudButton Disabled="@loading" Color="Color.Success" Class="mx-auto mt-4" OnClick="Download" Variant="Variant.Filled" StartIcon="@Icons.Custom.FileFormats.FilePdf">PDF Download</MudButton>
                    </MudItem>
                </MudGrid>
            </MudPaper>
        </div>
    </Authorized>
</AuthorizeView>
@code {
    private bool loading = false;
    private int? CodeInput { get; set; }
    private DateRange _dateRange = new DateRange(DateTime.Now.Date, DateTime.Now.Date);

    private async Task Download(MouseEventArgs args)
    {
        loading = true;
        var file = await Api.GetLedgerReport(CodeInput ?? 0, _dateRange.Start ??= DateTime.Now, _dateRange.End ??= DateTime.Now).ConfigureAwait(false);
        if (file?.FileName?.Contains("error", StringComparison.CurrentCultureIgnoreCase) == false)
        {

            await Js.SaveAs(file.FileName, file?.File);
        }
        loading = false;
    }
}
